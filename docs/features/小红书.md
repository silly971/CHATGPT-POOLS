# 小红书（XHS）功能启用指南

本功能包含：
- 管理后台「小红书订单」：配置凭证、同步订单、查看/清理订单
- 用户侧 `/redeem/xhs`：输入邮箱 + 小红书订单号，自动匹配并完成兑换

## 1) 开启功能开关

- 进入管理后台：`/admin/settings`
- 在「功能开关」中启用「小红书（订单同步/兑换）」

禁用时相关页面与接口会返回 `403`（`FEATURE_DISABLED`）。

## 2) 配置小红书凭证

- 进入管理后台：`/admin/xhs-orders`
- 使用「粘贴 cURL」方式配置（推荐）：从浏览器 Network 中复制小红书后台请求的 cURL 命令粘贴保存
  - 系统会解析并保存 `Authorization`、`Cookie` 以及签名相关头（如 `x-s`、`x-t` 等）

## 3) 配置兑换码库存（必须）

- 进入管理后台：`/admin/redemption-codes`
- 为渠道 `xhs` 创建兑换码库存（系统会按规则匹配“今日可用”的兑换码）

> 没有配置库存时，用户侧会提示“兑换码暂无库存/未配置”。

## 4) 可选：开启自动同步调度

后端会按环境变量启动调度器（默认启用）：
- `XHS_AUTO_SYNC_SCHEDULER_ENABLED`：默认 `true`
- `XHS_AUTO_SYNC_CHECK_INTERVAL_SECONDS`：默认 `60`

同步策略（是否同步、间隔小时数）在后台「小红书订单」页面配置并入库。

## 5) 验证

- 访问用户侧页面：`/redeem/xhs`
- 输入邮箱 + 订单号
  - 若订单尚未入库：系统会使用已保存的凭证尝试“按订单号搜索同步”
  - 同步成功后会完成兑换并提示邀请状态
